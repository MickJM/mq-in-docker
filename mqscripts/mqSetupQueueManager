#!/bin/bash
#
set +e
#
echo "SetupQueueManager: Setup QM "
echo "----------------------------"
#
DIR=`pwd`
LOGFILE=/tmp/mqSetupQueueManager_$(date +%Y%m%d_%H%M%S_%N)
#
# Create the initial setup dynamically ...
#
createmqscdefaults()
{
   rm -rf ${DIR}/qmgrs/${IBM_MQ_QUEUEMANAGER}/${CONFIG}/initialsetup.mqsc
   mkdir -p ${DIR}/qmgrs/${IBM_MQ_QUEUEMANAGER}/${CONFIG}
   echo "define ql(DEAD.LETTER.QUEUE) LIKE (SYSTEM.DEAD.LETTER.QUEUE)" >> ${DIR}/qmgrs/${IBM_MQ_QUEUEMANAGER}/${CONFIG}/initialsetup.mqsc
   echo "Listener name : TCP.${IBM_MQ_LISTENER}"
   echo "define listener(TCP.${IBM_MQ_LISTENER}) trptype(TCP) control(QMGR) port(${IBM_MQ_LISTENER}) descr('Default Listener') replace" >> ${DIR}/qmgrs/${IBM_MQ_QUEUEMANAGER}/${CONFIG}/initialsetup.mqsc
   echo "start listener(TCP.${IBM_MQ_LISTENER})" >> ${DIR}/qmgrs/${IBM_MQ_QUEUEMANAGER}/${CONFIG}/initialsetup.mqsc
}
#
# Apply configurations
#
applyconfig()
{
   for MQSC_FILE in $(ls -v ${DIR}/qmgrs/${IBM_MQ_QUEUEMANAGER}/config/*.mqsc); do
      echo "mqsc    : ${MQSC_FILE}"
      touch ${LOGFILE}
      runmqsc ${IBM_MQ_QUEUEMANAGER} < ${MQSC_FILE} >> ${LOGFILE}
   done
}
#
createmqscdefaults
#
applyconfig
#
